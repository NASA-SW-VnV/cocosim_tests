{
    "ava2_PP": {
        "AllCompiledSampleTimes": [
            [
                0.1,
                0
            ]
        ],
        "BlockType": "block_diagram",
        "CompiledSampleTime": [
            0.1,
            0
        ],
        "Content": {
            "Constant": {
                "AttributesFormatString": "",
                "BlockType": "Constant",
                "CompiledPortComplexSignals": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 0,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDataTypes": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": [
                        "double"
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDimensions": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": [
                        2,
                        90,
                        6
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortWidths": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 540,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledSampleTime": [
                    null,
                    0
                ],
                "FramePeriod": "inf",
                "Handle": 4.2825927734375,
                "LineHandles": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 29.2037353515625,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "LockScale": "off",
                "Name": "Constant",
                "Origin_path": "ava2_PP/Constant",
                "OutDataTypeStr": "Inherit: Inherit from 'Constant value'",
                "OutMax": "[]",
                "OutMin": "[]",
                "Path": "ava2_PP/Constant",
                "PortConnectivity": {
                    "DstBlock": 6.2852783203125,
                    "DstPort": 2,
                    "Position": [
                        390,
                        270
                    ],
                    "SrcBlock": [],
                    "SrcPort": [],
                    "Type": "1"
                },
                "Ports": [
                    0,
                    1,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0
                ],
                "Position": [
                    300,
                    254,
                    385,
                    286
                ],
                "SampleTime": "inf",
                "Value": "env_WMMGC",
                "VectorParams1D": "on"
            },
            "Constant1": {
                "AttributesFormatString": "",
                "BlockType": "Constant",
                "CompiledPortComplexSignals": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 0,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDataTypes": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": [
                        "double"
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDimensions": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": [
                        1,
                        90
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortWidths": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 90,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledSampleTime": [
                    null,
                    0
                ],
                "FramePeriod": "inf",
                "Handle": 5.2822265625,
                "LineHandles": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 30.2022705078125,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "LockScale": "off",
                "Name": "Constant1",
                "Origin_path": "ava2_PP/Constant1",
                "OutDataTypeStr": "Inherit: Inherit from 'Constant value'",
                "OutMax": "[]",
                "OutMin": "[]",
                "Path": "ava2_PP/Constant1",
                "PortConnectivity": {
                    "DstBlock": 6.2852783203125,
                    "DstPort": 3,
                    "Position": [
                        390,
                        310
                    ],
                    "SrcBlock": [],
                    "SrcPort": [],
                    "Type": "1"
                },
                "Ports": [
                    0,
                    1,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0
                ],
                "Position": [
                    300,
                    294,
                    385,
                    326
                ],
                "SampleTime": "inf",
                "Value": "env_Snm",
                "VectorParams1D": "on"
            },
            "In1": {
                "AttributesFormatString": "",
                "BlockType": "Inport",
                "BusObject": "BusObject",
                "CompiledPortComplexSignals": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 0,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDataTypes": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": [
                        "double"
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDimensions": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": [
                        1,
                        1
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortWidths": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 1,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledSampleTime": [
                    0.1,
                    0
                ],
                "Handle": 2.2801513671875,
                "LineHandles": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 27.2021484375,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "Name": "In1",
                "Origin_path": "ava2_PP/In1",
                "OutMax": "[]",
                "OutMin": "[]",
                "Path": "ava2_PP/In1",
                "Port": "1",
                "PortConnectivity": {
                    "DstBlock": 6.2852783203125,
                    "DstPort": 0,
                    "Position": [
                        365,
                        190
                    ],
                    "SrcBlock": [],
                    "SrcPort": [],
                    "Type": "1"
                },
                "Ports": [
                    0,
                    1,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0
                ],
                "Position": [
                    330,
                    183,
                    360,
                    197
                ],
                "UseBusObject": "off"
            },
            "In2": {
                "AttributesFormatString": "",
                "BlockType": "Inport",
                "BusObject": "BusObject",
                "CompiledPortComplexSignals": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 0,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDataTypes": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": [
                        "double"
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDimensions": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": [
                        1,
                        3
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortWidths": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 3,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledSampleTime": [
                    0.1,
                    0
                ],
                "Handle": 3.286376953125,
                "LineHandles": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [],
                    "LConn": [],
                    "Outport": 28.20263671875,
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "Name": "In2",
                "Origin_path": "ava2_PP/In2",
                "OutMax": "[]",
                "OutMin": "[]",
                "Path": "ava2_PP/In2",
                "Port": "2",
                "PortConnectivity": {
                    "DstBlock": 6.2852783203125,
                    "DstPort": 1,
                    "Position": [
                        365,
                        230
                    ],
                    "SrcBlock": [],
                    "SrcPort": [],
                    "Type": "1"
                },
                "Ports": [
                    0,
                    1,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0
                ],
                "Position": [
                    330,
                    223,
                    360,
                    237
                ],
                "UseBusObject": "off"
            },
            "Out1": {
                "AttributesFormatString": "",
                "BlockType": "Outport",
                "BusObject": "BusObject",
                "CompiledPortComplexSignals": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": 0,
                    "LConn": [],
                    "Outport": [],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDataTypes": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [
                        "double"
                    ],
                    "LConn": [],
                    "Outport": [],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDimensions": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [
                        1,
                        3
                    ],
                    "LConn": [],
                    "Outport": [],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortWidths": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": 3,
                    "LConn": [],
                    "Outport": [],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledSampleTime": [
                    0.1,
                    0
                ],
                "Handle": 25.210693359375,
                "InitialOutput": "[]",
                "LineHandles": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": 31.2020263671875,
                    "LConn": [],
                    "Outport": [],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "Name": "Out1",
                "Origin_path": "ava2_PP/Out1",
                "OutMax": "[]",
                "OutMin": "[]",
                "OutputWhenDisabled": "held",
                "Path": "ava2_PP/Out1",
                "Port": "1",
                "PortConnectivity": {
                    "DstBlock": [],
                    "DstPort": [],
                    "Position": [
                        665,
                        210
                    ],
                    "SrcBlock": 6.2852783203125,
                    "SrcPort": 0,
                    "Type": "1"
                },
                "Ports": [
                    1,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0
                ],
                "Position": [
                    670,
                    203,
                    700,
                    217
                ],
                "UseBusObject": "off"
            },
            "Out2": {
                "AttributesFormatString": "",
                "BlockType": "Outport",
                "BusObject": "BusObject",
                "CompiledPortComplexSignals": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": 0,
                    "LConn": [],
                    "Outport": [],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDataTypes": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [
                        "double"
                    ],
                    "LConn": [],
                    "Outport": [],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDimensions": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [
                        1,
                        3
                    ],
                    "LConn": [],
                    "Outport": [],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortWidths": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": 3,
                    "LConn": [],
                    "Outport": [],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledSampleTime": [
                    0.1,
                    0
                ],
                "Handle": 26.2060546875,
                "InitialOutput": "[]",
                "LineHandles": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": 32.2027587890625,
                    "LConn": [],
                    "Outport": [],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "Name": "Out2",
                "Origin_path": "ava2_PP/Out2",
                "OutMax": "[]",
                "OutMin": "[]",
                "OutputWhenDisabled": "held",
                "Path": "ava2_PP/Out2",
                "Port": "2",
                "PortConnectivity": {
                    "DstBlock": [],
                    "DstPort": [],
                    "Position": [
                        665,
                        295
                    ],
                    "SrcBlock": 6.2852783203125,
                    "SrcPort": 1,
                    "Type": "1"
                },
                "Ports": [
                    1,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0
                ],
                "Position": [
                    670,
                    288,
                    700,
                    302
                ],
                "UseBusObject": "off"
            },
            "WMM2010": {
                "AttributesFormatString": "",
                "BlockType": "SubSystem",
                "CompiledPortComplexSignals": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [
                        0,
                        0,
                        0,
                        0
                    ],
                    "LConn": [],
                    "Outport": [
                        0,
                        0
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDataTypes": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [
                        "double",
                        "double",
                        "double",
                        "double"
                    ],
                    "LConn": [],
                    "Outport": [
                        "double",
                        "double"
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortDimensions": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [
                        1,
                        1,
                        1,
                        3,
                        2,
                        90,
                        6,
                        1,
                        90
                    ],
                    "LConn": [],
                    "Outport": [
                        1,
                        3,
                        1,
                        3
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledPortWidths": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [
                        1,
                        3,
                        540,
                        90
                    ],
                    "LConn": [],
                    "Outport": [
                        3,
                        3
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "CompiledSampleTime": [
                    0.1,
                    0
                ],
                "DataTypeOverride": "UseLocalSettings",
                "Handle": 6.2852783203125,
                "Inputs": [
                    {
                        "ArraySize": "-1",
                        "CompiledSize": "1",
                        "CompiledType": "double",
                        "Datatype": "Inherit: Same as Simulink",
                        "Id": 711,
                        "Name": "gps_sec",
                        "Port": 1,
                        "Scope": "Input"
                    },
                    {
                        "ArraySize": "-1",
                        "CompiledSize": "3",
                        "CompiledType": "double",
                        "Datatype": "Inherit: Same as Simulink",
                        "Id": 713,
                        "Name": "rp",
                        "Port": 2,
                        "Scope": "Input"
                    },
                    {
                        "ArraySize": "-1",
                        "CompiledSize": "[90, 6]",
                        "CompiledType": "double",
                        "Datatype": "Inherit: Same as Simulink",
                        "Id": 714,
                        "Name": "WMMGC",
                        "Port": 3,
                        "Scope": "Input"
                    },
                    {
                        "ArraySize": "-1",
                        "CompiledSize": "90",
                        "CompiledType": "double",
                        "Datatype": "Inherit: Same as Simulink",
                        "Id": 715,
                        "Name": "Snm",
                        "Port": 4,
                        "Scope": "Input"
                    }
                ],
                "IsSubsystemVirtual": "off",
                "LineHandles": {
                    "Enable": [],
                    "Ifaction": [],
                    "Inport": [
                        27.2021484375,
                        28.20263671875,
                        29.2037353515625,
                        30.2022705078125
                    ],
                    "LConn": [],
                    "Outport": [
                        31.2020263671875,
                        32.2027587890625
                    ],
                    "RConn": [],
                    "Reset": [],
                    "State": [],
                    "Trigger": []
                },
                "Mask": "off",
                "MaskType": "",
                "MinAlgLoopOccurrences": "off",
                "MinMaxOverflowLogging": "UseLocalSettings",
                "Name": "WMM2010",
                "Origin_path": "ava2_PP/WMM2010",
                "Outputs": [
                    {
                        "ArraySize": "-1",
                        "CompiledSize": "3",
                        "CompiledType": "double",
                        "Datatype": "Inherit: Same as Simulink",
                        "Id": 712,
                        "Name": "Becf",
                        "Port": 1,
                        "Scope": "Output"
                    },
                    {
                        "ArraySize": "-1",
                        "CompiledSize": "3",
                        "CompiledType": "double",
                        "Datatype": "Inherit: Same as Simulink",
                        "Id": 716,
                        "Name": "Bunit",
                        "Port": 2,
                        "Scope": "Output"
                    }
                ],
                "Path": "ava2_PP/WMM2010",
                "Permissions": "ReadWrite",
                "PermitHierarchicalResolution": "ExplicitOnly",
                "PortConnectivity": [
                    {
                        "DstBlock": [],
                        "DstPort": [],
                        "Position": [
                            445,
                            190
                        ],
                        "SrcBlock": 2.2801513671875,
                        "SrcPort": 0,
                        "Type": "1"
                    },
                    {
                        "DstBlock": [],
                        "DstPort": [],
                        "Position": [
                            445,
                            230
                        ],
                        "SrcBlock": 3.286376953125,
                        "SrcPort": 0,
                        "Type": "2"
                    },
                    {
                        "DstBlock": [],
                        "DstPort": [],
                        "Position": [
                            445,
                            270
                        ],
                        "SrcBlock": 4.2825927734375,
                        "SrcPort": 0,
                        "Type": "3"
                    },
                    {
                        "DstBlock": [],
                        "DstPort": [],
                        "Position": [
                            445,
                            310
                        ],
                        "SrcBlock": 5.2822265625,
                        "SrcPort": 0,
                        "Type": "4"
                    },
                    {
                        "DstBlock": 25.210693359375,
                        "DstPort": 0,
                        "Position": [
                            640,
                            210
                        ],
                        "SrcBlock": [],
                        "SrcPort": [],
                        "Type": "1"
                    },
                    {
                        "DstBlock": 26.2060546875,
                        "DstPort": 0,
                        "Position": [
                            640,
                            295
                        ],
                        "SrcBlock": [],
                        "SrcPort": [],
                        "Type": "2"
                    }
                ],
                "Ports": [
                    4,
                    2,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0
                ],
                "Position": [
                    450,
                    165,
                    635,
                    335
                ],
                "PropExecContextOutsideSubsystem": "off",
                "SFBlockType": "MATLAB Function",
                "Script": "%% World Magnetic Model (Valid until Dec 31 2015, needs coefficient update and leap year compesation after this date)\n% Requires file magm.m\n\n%% Code\nfunction [Becf, Bunit] = fcn(gps_sec,rp, WMMGC, Snm)\n\n\n[Becf,Bunit]= magm(rp,gps_sec, WMMGC, Snm);\n\nend\n\nfunction [Becf,Bunit]=magm(rp,gps_sec,WMMGC, Snm)\n%#codegen\n% This function computes the magnetic field vector at a given position in space\n% Note: altitude limited to 850km above the geomagnetic referemce radius (6371.2 km)\n\n% Vivek Nagabhushan\n% May 31 2013le\n% Millenium Engineering and Integration Company\n% Revised 02/12/2018 Sonny - Model(i.e. WMMGC, snm) is valid through 01/01/2020\n\n% Inputs: Schmidt normalized WMM Gaussian coefficients, position vector in\n% the form rp=[phi_gd lambda h_ellp] where, h_ellp is the height above the WGS-84 ellipsoid in kilometers, phi_gd is\n% the geodetic latitude in degrees, and lambda is the East longitude from the Greenwich meridian in degrees\n\n% Output: Unit magnetic field vector in ECEF coordinates. Other output forms\n% can be chosen if desired\n\n% Other files: index.m, coeffcnvrt.m, R_ECF_NED.m, WMMGC.mat, and Snm.mat\n\n% References:\n% 1. Maus, S., S. Macmillan, S. McLean, B. Hamilton, A. Thomson, M. Nair, and C. Rollins, 2010, The US/UK World Magnetic Model for 2010-2015\n% 2. Plett, M., 'Magnetic Models' in 'Spacecraft Attitude Determination and Control', Edited by Wertz, J., Kluwer Academic Publishers, 1990\n% 3. Davis, J., 'Mathematical Modeling of Earth's Magnetic Field', Technical Note, 'http://hanspeterschaub.info/Papers/UnderGradStudents/MagneticField.pdf', 2004\n% 4. Notation for latitude and longitude consistent with Vallado, D. A., 'Fundamentals of Astrodynamics and Applications', 4th Edition, Space Technology Library, 2013\n\n%years since 2015-01-01-00:00:00\n% seconds between 2015-01-01-00:00:00 and 1980-01-06:00:00:00 = 1104105616\nwmm_sec = gps_sec - 1104105616;\nyears   = wmm_sec/60/60/24/365;\nif(gps_sec > 1140739217) %then leap day has occured!\n    years = years + 1/365;\nend\n\n\nr_mag=6371.200; % Geomagnetic reference radius of the Earth in kilometers\nRe=6378.137; % Semi-major axis of the Earth ellipsoid / Earth Equatorial radius in kilometers\nesquared=0.006694379990141; % Eccentricity that models the Earth oblateness\n[g,h]=coeffcnvrt(years, WMMGC, Snm); % Returns Schmidt normalized Gaussian coefficients\n\n\nphi_gd=rp(1)*pi/180; % Geodetic Latitude\nlambda=rp(2)*pi/180; % Geodetic Longitude = Geocentric Longitude\nh_ellp=rp(3); % Height above the reference ellipsoid in kilometers (The height reported by GPS is the height above ellipsoid or HAE. The ellipsoid is the WGS84 )\n\n% Convert Geodetic coordinates to Geocentric \nC=Re/sqrt(1-esquared*sin(phi_gd)^2);\nrd=(C+h_ellp)*cos(phi_gd);\nrk=(C*(1-esquared)+h_ellp)*sin(phi_gd);\nr=sqrt(rd^2+rk^2); % Geocentric distance\nphi_gc=asin(rk/r); % Conversion from Geodetic Latitude to Geocentric Latitude\nco_phi_gc=(pi/2)-phi_gc; % Conversion from latitude to co-latitude\ns=sin(co_phi_gc);\nc=cos(co_phi_gc);\ncl=cos(lambda);\nsl=sin(lambda);\n\nK=zeros(90,1);\nP=zeros(90,1);\ndP=zeros(90,1);\nBr=0; \nBp=0; %B_phi\nBl=0; %B_lambda\n\n\n% Compute coefficients K and Gaussian-normalized associated Legendre functions, Pnm\n\nP(1)=c;\nP(2)=s;\nP(3)=c^2-0.33333;\nP(4)=c*s;\nP(5)=s^2;\ndP(1)=-s;\ndP(2)=c;\ndP(3)=-2*s*c;\ndP(4)=c^2-s^2;\ndP(5)=2*s*c;\n\n\nfor n=3:12 % Note that values of the fucntions for n=1,2 have been precomputed so that the case of index(0,0) is not encountered\n    for m=0:n\n        \n        if m==n\n            P(index(n,m))=s*P(index(n-1,m-1));\n            dP(index(n,m))=s*dP(index(n-1,m-1))+c*P(index(n-1,m-1));\n        else\n            if m>(n-2)\n                Pnm2=0;\n                dPnm2=0;\n            else\n                Pnm2=P(index(n-2,m));\n                dPnm2=dP(index(n-2,m));\n            end\n            \n            K(index(n,m))=((n-1)^2-m^2)/((2*n-1)*(2*n-3)); % Note that K(1,1) and K(1,0) are equal to zero\n            P(index(n,m))=c*P(index(n-1,m))-K(index(n,m))*Pnm2;\n            dP(index(n,m))=c*dP(index(n-1,m))-s*P(index(n-1,m))-K(index(n,m))*dPnm2;\n        end\n               \n    end\nend\n\n\n% Spherical coordinate components (Br,B_phi,B_lambda) of magnetic field\n\ncml=0;sml=0;cmm1l=0;smm1l=0; % Initialize to avoid error in Simulink\n\nfor n=1:12\n    for m=0:n\n        \n        if m==0\n            cml=1; % cos(m*lambda) and sin(m*lambda)\n            sml=0; \n            cmm1l=cml; % cos(m-1*(lambda)) and sin((m-1)*lambda) for next iteration\n            smm1l=sml; \n        else\n            cml=cmm1l*cl-smm1l*sl;\n            sml=smm1l*cl+cmm1l*sl;\n            cmm1l=cml; % cos(m-1*(phi)) and sin((m-1)*phi) for next iteration\n            smm1l=sml; \n        end    \n        \n        Br=Br+(n+1)*((r_mag/r)^(n+2))*(g(index(n,m))*cml+h(index(n,m))*sml)*P(index(n,m));\n        \n        Bp=Bp-((r_mag/r)^(n+2))*(g(index(n,m))*cml+h(index(n,m))*sml)*dP(index(n,m));\n        \n        Bl=Bl-(((r_mag/r)^(n+2))*m*(-g(index(n,m))*sml+h(index(n,m))*cml)*P(index(n,m)))/(s);\n        \n    end\nend\n\nepsilon=phi_gd-phi_gc;\n\n% Earth centric NED coordinates of magnetic field\nBn=-Bp*cos(epsilon)-Br*sin(epsilon); %N\nBe=Bl;                               %E\nBd=Bp*sin(epsilon)-Br*cos(epsilon);  %D\n\nBned=[Bn;Be;Bd];\n\n%Earth centric Earth Fixed (ECEF) components of the magnetic field\nBecf=R_ECF_NED(phi_gd,lambda)*Bned;\nBmag=norm(Becf);\n\nBunit=Becf/Bmag; % Unit magnetic vector in ECEF coordinates\nend\n\nfunction i=index(n,m)\n%#codegen\ni=0.5*(n*(n+1))+m;\n\nend\n\n\n\nfunction [g,h]=coeffcnvrt(years,WMMGC,Snm)\n% This file converts the Schmidt-normalized Gauss coefficients given in the\n% NGDC coefficient file to Gaussain coefficients for use in the file magm.m\n% Requires the WMM2010 coefficient file by NGDC\n% WARNING: This file is valid only till 01 01 2015 00:00:00\n\n% Vivek Nagabhushan\n% 06/03/2013\n% Millenium Engineering and Integration Company\n\n% Inputs: WMM Coefficient file WWMGC, \n%         time in decimal years (correct to a day)\n% Output: Gaussian coefficients 'g' and 'h'\n\n% References:\n% 1. Maus, S., S. Macmillan, S. McLean, B. Hamilton, A. Thomson, M. Nair, and C. Rollins, 2010, The US/UK World Magnetic Model for 2010-2015\n% 2. Plett, M., 'Magnetic Models' in 'Spacecraft Attitude Determination and Control', Edited by Wertz, J., Kluwer Academic Publishers, 1990\n% 3. Davis, J., 'Mathematical Modeling of Earth's Magnetic Field', Technical Note, 'http://hanspeterschaub.info/Papers/UnderGradStudents/MagneticField.pdf', 2004\n\n% End compute decimal years\ngmain=WMMGC(1:90,3);\nhmain=WMMGC(1:90,4);\ngdot=WMMGC(1:90,5);\nhdot=WMMGC(1:90,6);\n\ng=Snm.*(gmain+gdot.*years);\nh=Snm.*(hmain+hdot.*years);\n\nend\n\n\n\nfunction R=R_ECF_NED(phi_gd,lambda)\n%#codegen\n%%\n%  This function generates the rotation matrix that converts representations in the terrestrial NED coordinate basis to the ECEF frame \n%  The NED basis is formed by: D along the inward normal to the WGS-84 ellipsoid, N along the direction of the North Pole (and E along the Eastward direction)\n%  The ECEF bases is formed by: X along the Greenwich meridian in the equatorial plane, Z along the North pole (and Y completes the right-handed system)\n%  Input: Geodetic latitude and longitude degrees\n%  Output: Rotation matrix from NED to ECEF\n%%  References: \n%  1. Vallado, D. A., 'Fundamentals of Astrodynamics and Applications', 4th Edition, Space Technology Library, 2013, pp. 138,144\n%  2. World Geodetic System 1984, NIMA TR8350.2, Third Edition, Ammendment 1, Jan 2000, http://earth-info.nga.mil/GandG/publications/tr8350.2/wgs84fin.pdf\n%%\n%  Vivek Nagabhushan (vnagabhushan@meicompany.com)\n%  Millennium Engineering and Integration Company\n%  07/02/2013\n%%\n\n\nR=R3(-lambda)*R2((pi/2)+phi_gd);\nend\n\nfunction R=R3(theta)\n%#codegen\nR=[cos(theta) sin(theta)  0;\n  -sin(theta) cos(theta)  0;\n       0          0       1];\nend\n\nfunction R=R2(theta)\n%#codegen\nR=[cos(theta) 0 -sin(theta);\n       0      1     0\n   sin(theta) 0 cos(theta)];\nend\n\n\n\n\n\n\n",
                "ShowPortLabels": "FromPortIcon",
                "TemplateBlock": "",
                "TreatAsAtomicUnit": "on",
                "Virtual": "off"
            }
        },
        "Handle": 0.2801513671875,
        "Name": "ava2_PP",
        "Origin_path": "ava2_PP",
        "Path": "ava2_PP"
    },
    "meta": {
        "Declarations": {
            "Enumerations": []
        },
        "date": "23-Oct-2020",
        "file_path": "/Users/hbourbou/Documents/babelfish.arc.nasa.gov/cocosim_github/cocosim_tests/Simulink/unitTests/MATLABFunction/ava/ava2_PP.slx",
        "sampleTime": 0.1
    }
}
